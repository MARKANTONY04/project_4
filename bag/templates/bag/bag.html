{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h1 class="mb-4">Your Bag</h1>

  {% if bag_items %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="thead-dark">
          <tr>
            <th scope="col">Item</th>
            <th scope="col">Type</th>
            <th scope="col">Price</th>
            <th scope="col" style="width:120px;">Quantity</th>
            <th scope="col">Subtotal</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          {% for item in bag_items %}
            <tr>
              <td>
                <strong>{{ item.product.name|default:item.product.title }}</strong><br>
                <small>{{ item.product.description|default:item.product.content_summary|truncatewords:12 }}</small>
              </td>
              <td class="text-capitalize">{{ item.type }}</td>
              <td>£{{ item.price }}</td>
              <td>
                <!-- Update form -->
                <form action="{% url 'bag:update_bag' item.type item.id %}" method="POST" class="d-flex">
                  {% csrf_token %}
                  <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="form-control form-control-sm mr-2" style="width: 70px;">
                  <input type="hidden" name="redirect_url" value="{{ request.path }}">
                  <button type="submit" class="btn btn-sm btn-primary">Update</button>
                </form>
              </td>
              <td>£{{ item.subtotal }}</td>
              <td>
                <!-- Remove form -->
                <form action="{% url 'bag:remove_from_bag' item.type item.id %}" method="POST">
                  {% csrf_token %}
                  <input type="hidden" name="redirect_url" value="{{ request.path }}">
                  <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Totals -->
    <div class="row mt-4">
      <div class="col-md-6 offset-md-6">
        <div class="card p-3 shadow-sm">
          <h4 class="d-flex justify-content-between">
            <span>Total:</span>
            <span>£{{ grand_total }}</span>
          </h4>
          <div class="mt-3 d-flex justify-content-between">
            <a href="{% url 'services:services_list' %}" class="btn btn-outline-secondary">Continue Shopping</a>
            <a href="{% url 'checkout:checkout' %}" class="btn btn-success">Proceed to Checkout</a>
          </div>
        </div>
      </div>
    </div>

  {% else %}
    <div class="alert alert-info text-center">
      <h4>Your bag is empty</h4>
      <p><a href="{% url 'services:services_list' %}">Browse our services</a> to add something!</p>
    </div>
  {% endif %}
</div>
{% endblock %}
